hw 3
================
cathy
2024-10-13

Load the package that needed for this hw.

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.1     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.3     ✔ tidyr     1.3.1
    ## ✔ purrr     1.0.2     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

## Problem 2

import and clean “nhanes_covar” data

``` r
 covar_df =  
   read_csv("data/nhanes_covar.csv", 
             na = c("NA",".",""),
             skip = 4
            ) |> 
   janitor::clean_names()
```

    ## Rows: 250 Columns: 5
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (5): SEQN, sex, age, BMI, education
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

import and clean “nhanes_accel” data create a total activity variable
for each participant

``` r
 accel_df =  
   read_csv("data/nhanes_accel.csv", 
             na = c("NA",".","")) |> 
   janitor::clean_names() |>
   mutate(total_activity = 
            rowSums(across(starts_with("min")), na.rm = TRUE)) |> 
   relocate(total_activity)
```

    ## Rows: 250 Columns: 1441
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (1441): SEQN, min1, min2, min3, min4, min5, min6, min7, min8, min9, min1...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Merge the 2 dataset into 1

``` r
 merged_df =
   covar_df|> 
   left_join(accel_df, by = "seqn") |> 
   mutate(
    sex = factor(sex, levels = c(1, 2), labels = c("Male", "Female")),
    education = factor(education, levels = c(1, 2, 3), labels = c("Less than High School", "High School Equivalent", "More than High School"))
  ) |> 
   filter(age >= 21, !is.na(sex), !is.na(bmi), !is.na(education)) |> 
   relocate(seqn, sex, age, bmi, education, total_activity)
```

Create a visualization of the age distributions for men and women in
each education category

``` r
edu_bysex_table =
  merged_df |> 
  group_by(sex, education) |> 
  summarise(count = n(), .groups = 'drop')
```

create histogram and box plot

``` r
edu_bysex_plot =
  ggplot(merged_df, aes(x = age, fill = sex)) +
  geom_histogram(position = "dodge", bins = 10) +
  facet_grid(sex ~ education) +
  labs(title = "Age Distribution by Sex and Education",
       x = "Age",
       y = "Count") +
  theme_minimal()

print(edu_bysex_plot)
```

![](p8105_hw3_qc2337_files/figure-gfm/unnamed-chunk-6-1.png)<!-- -->

``` r
age_boxplot = ggplot(merged_df, aes(x = education, y = age, fill = sex)) +
  geom_boxplot() +
  facet_wrap(~ sex) +
  labs(title = "Age Distribution by Sex and Education",
       x = "Education",
       y = "Age") +
  theme_minimal()

print(age_boxplot)
```

![](p8105_hw3_qc2337_files/figure-gfm/unnamed-chunk-7-1.png)<!-- -->

Comment:

Plot these total activities (y-axis) against age (x-axis) compare men to
women and have separate panels for each education level

``` r
 activity_plot =
   ggplot(merged_df, aes(x = age, y = total_activity, color = sex)) +
   geom_point(alpha = 0.5) +  
   geom_smooth(se = FALSE) + 
   facet_wrap(~ education, scales = "free_y") + 
   labs(title = "Total Daily Activity by Age, Sex, and Education Level",
        x = "Age",
        y = "Total Activity",
        color = "Sex") +
  theme_minimal() + 
  theme(legend.position = "bottom")

print(activity_plot)
```

    ## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'

![](p8105_hw3_qc2337_files/figure-gfm/unnamed-chunk-8-1.png)<!-- -->

Comment:

Make a three-panel plot that shows the 24-hour activity time courses for
each education level and use color to indicate sex

``` r
long_accel_df =
  merged_df |> 
  pivot_longer(
    cols = starts_with("min"),
    names_to = "minute",
    names_prefix = "min",
    values_to = "activity_level"
  ) |> 
  mutate(
    minute = as.numeric(sub("min", "", minute)) / 1440 * 24 
  )
```

``` r
 time_course_plot =
   ggplot(long_accel_df, aes(x = minute, y = activity_level, color = sex)) +
   geom_line(alpha = 0.3, size = 0.5) + 
   geom_smooth(se = FALSE, span = 0.2) + 
   facet_wrap(~ education, scales = "free_y") + 
   labs(
        title = "24-Hour Activity Time Course by Education Level and Sex",
        x = "Time of Day (hours)",
        y = "Activity Level",
        color = "Sex") +
   theme_minimal() +  
   theme(legend.position = "bottom", plot.title = element_text(hjust = 0.5))
```

    ## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
    ## ℹ Please use `linewidth` instead.
    ## This warning is displayed once every 8 hours.
    ## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
    ## generated.

``` r
print(time_course_plot)
```

    ## `geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'

![](p8105_hw3_qc2337_files/figure-gfm/unnamed-chunk-10-1.png)<!-- -->

Describe:
